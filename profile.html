<!doctype html><html lang="ms"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<base href="./">
<link rel="icon" type="image/png" href="./assets/favicon.png">
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/theme.css"><title>Profil – KB-JPS</title></head><body>
<div id="header"></div>
<div class="container">
<div class="grid"><div class="col-12 card form">
  <div class="btnrow"><a class="btn secondary" href="./menu.html">← Dashboard</a></div>
  <h2>Profil</h2><p>Maklumat pengguna semasa.</p>
  <div class="grid">
    <div class="col-6"><div class="kpi"><small>Nama</small><b id="pName">—</b></div></div>
    <div class="col-6"><div class="kpi"><small>Emel</small><b id="pEmail">—</b></div></div>
    <div class="col-6"><div class="kpi"><small>Role</small><b id="pRole">—</b></div></div>
    <div class="col-6"><div class="kpi"><small>Token</small><b id="pToken" style="font-size:12px">—</b></div></div>
  </div>
  <hr class="sep">
  <h3>Tukar kata laluan</h3>
  <div class="grid">
    <div class="col-6"><div class="field"><label>Password baru</label><input class="input" id="newPass" type="password"></div></div>
    <div class="col-6"><div class="field"><label>Sahkan</label><input class="input" id="newPass2" type="password"></div></div>
  </div>
  <div class="btnrow"><button class="btn" id="btnChangePass" type="button">Simpan</button></div>
</div></div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const { auth, users, ui } = window.KBJPS;
  const s = auth.session(); if(!s) return;
  pName.textContent=s.name||'-'; pEmail.textContent=s.email||'-'; pRole.textContent=s.role||'-'; pToken.textContent=s.token||'-';
  btnChangePass.addEventListener('click', () => {
    const p1=newPass.value, p2=newPass2.value;
    if(!p1 || p1!==p2){ ui.toast('Password tidak sama / kosong.', 'warn'); return; }
    const res=users.resetPassword(s.email, p1);
    if(!res.ok){ ui.toast(res.message||'Gagal.', 'err'); return; }
    ui.toast('Password ditukar.', 'ok'); newPass.value=''; newPass2.value='';
  });
});
</script>
</div>
<div id="footer"></div>
<script src="./js/utils.js" defer></script>
<script src="./js/script.js" defer></script>

</body></html>